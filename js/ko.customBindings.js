(function($){var dummyCallback=function(){};var uo=ko.utils.unwrapObservable;function uho(hash){hash=ko.utils.unwrapObservable(hash);if(typeof hash!="object"){return hash}for(var name in hash){hash[name]=ko.utils.unwrapObservable(hash[name])}return hash}function searchElementsForSmartBinding(selector,startingElement){var candidates=startingElement.closest(selector);if(candidates.length>0){return candidates}candidates=$(selector);if(candidates.length>0){return candidates}return false}ko.bindingHandlers.enterKey={init:function(element,valueAccessor,allBindingsAccessor){var value=uho(valueAccessor());var elm=$(element);var isTextarea=elm.is("textarea");var isTextbox=elm.is('input[type="text"]')||elm.is('input[type="password"]');var config=ko.utils.extend({event:"keypress",acceptInput:elm.is("textarea")?true:false,moveFocus:false,submitForm:false,command:dummyCallback,withShift:dummyCallback,withCtrl:dummyCallback,withCtrlShift:dummyCallback,bubbling:true},(typeof value=="function"?{command:value}:value));var text=allBindingsAccessor().value||false;if(text){text=ko.isObservable(text)?text:false}$(element)[config.event](function(e){if((e.keyCode?e.keyCode:e.which?e.which:e.charCode)==13){if(config.bubbling===false){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}config.command(text);if(e.shiftKey&&e.ctrlKey){config.withCtrlShift();e.preventDefault();return false}else{if(e.shiftKey){config.withShift();e.preventDefault();return false}else{if(e.ctrlKey){config.withCtrl();e.preventDefault();return false}}}if(!config.moveFocus&&text&&config.acceptInput&&isTextbox){var str=elm.val();var caretPos=elm.caret().start;var left=str.substring(0,caretPos-1);var right=str.substring(caretPos);elm.val(left+"\n"+right);caretPos=elm.val().length-right.length;elm.caret(caretPos,caretPos)}if(!config.moveFocus&&text&&!config.acceptInput&&isTextarea){var str=elm.val();var caretPos=elm.caret().start;var left=str.substring(0,caretPos-2);if(left.substring(caretPos-2)=="\r"){left=left.substring(0,caretPos-3)}var right=str.substring(caretPos);elm.val(left+right);caretPos=elm.val().length-right.length;elm.caret(caretPos,caretPos)}if(config.moveFocus&&element.form){var i;var elements=element.form.elements;for(i=0;i<elements.length;i++){if(element==elements[i]){break}}i=(i+(e.shiftKey?-1:1))%elements.length;if(i<0){i+=elements.length}elements[i].focus()}if(!config.submitForm&&isTextbox){e.preventDefault();return false}else{if(config.submitForm&&isTextarea){element.form.submit()}}}})}};ko.bindingHandlers.tabKey={init:function(element,valueAccessor,allBindingsAccessor){var value=uho(valueAccessor());var elm=$(element);var config=ko.utils.extend({acceptInput:false,tabString:"	",command:dummyCallback},(typeof value=="function"?{command:value}:value));var text=allBindingsAccessor().value||false;if(text){text=ko.isObservable(text)?text:false}$(element).keydown(function(e){if((e.keyCode?e.keyCode:e.which?e.which:e.charCode)==9){config.command(text);if(text&&config.acceptInput){var str=elm.val();var caretPos=elm.caret().start;var left=str.substring(0,caretPos);var right=str.substring(caretPos);elm.val(left+config.tabString+right);caretPos=elm.val().length-right.length;elm.caret(caretPos,caretPos);e.preventDefault();return false}}})}};ko.bindingHandlers.escKey={init:function(element,valueAccessor){var value=uho(valueAccessor());var elm=$(element);var config=ko.utils.extend({command:dummyCallback},(typeof value=="function"?{command:value}:value));elm.keydown(function(e){if((e.keyCode?e.keyCode:e.which?e.which:e.charCode)==27){config.command()}})}};ko.bindingHandlers.fadeVisible={init:function(element,valueAccessor){var value=uo(valueAccessor());var elm=$(element);var config=ko.utils.extend({visible:undefined,showOnHover:false,hideOnHover:false,speed:"normal",complete:dummyCallback,showDelay:0,hideDelay:0,enableHover:true},(typeof value=="boolean"?{visible:value}:value));if(uo(config.visible)!==undefined){uo(config.visible)?elm.show():elm.hide();return}var timer=false;var clearTimer=function(){if(timer){clearTimeout(timer);timer=false}};var show=function(){elm.fadeIn(uo(config.speed),uo(config.complete))};var hide=function(){elm.fadeOut(uo(config.speed),uo(config.complete))};var showExec=function(){clearTimer();var delay=uo(config.showDelay);if(delay){timer=setTimeout(show,delay)}else{show()}};var hideExec=function(){clearTimer();if(elm.is(":animated")){elm.stop()}var delay=uo(config.hideDelay);if(delay){timer=setTimieout(hide,delay)}else{hide()}};var target;if(config.showOnHover){elm.hide();target=searchElementsForSmartBinding(config.showOnHover,elm);if(target){target.mouseenter(function(){if(uo(config.enableHover)){showExec()}}).mouseleave(hideExec)}}else{if(config.hideOnHover){target=searchElementsForSmartBinding(config.hideOnHover,elm);if(target){target.mouseenter(function(){if(uo(config.enableHover)){hideExec()}}).mouseleave(showExec)}}}},update:function(element,valueAccessor){var value=uho(valueAccessor());var elm=$(element);var config=ko.utils.extend({visible:undefined,speed:"normal",complete:dummyCallback,showDelay:0,hideDelay:0},(typeof value=="boolean"?{visible:value}:value));if(config.visible===undefined){return}var func=config.visible?function(){elm.fadeIn(config.speed,config.complete)}:function(){elm.fadeOut(config.speed,config.complete)};var delay=value.visible?config.showDelay:config.hideDelay;var timer=$.data(element,"ko.fadeVisible.update.timer");if(timer){clearTimeout(timer)}if(delay>0){$.data(element,"ko.fadeVisible.update.timer",setTimeout(func,delay))}else{func()}}};ko.bindingHandlers.slideVisible={init:function(element,valueAccessor){var value=uo(valueAccessor());var elm=$(element);var config=ko.utils.extend({showOnHover:false,hideOnHover:false,speed:"normal",complete:dummyCallback,showDelay:0,hideDelay:0,enableHover:true},(typeof value=="boolean"?{visible:value}:value));if(uo(config.visible)!==undefined){uo(config.visible)?elm.show():elm.hide();return}var timer=false;var clearTimer=function(){if(timer){clearTimeout(timer);timer=false}};var show=function(){elm.slideDown(uo(config.speed),uo(config.complete))};var hide=function(){elm.slideUp(uo(config.speed),uo(config.complete))};var showExec=function(){clearTimer();var delay=uo(config.showDelay);if(delay){timer=setTimeout(show,delay)}else{show()}};var hideExec=function(){clearTimer();if(elm.is(":animated")){elm.stop()}var delay=uo(config.hideDelay);if(delay){timer=setTimieout(hide,delay)}else{hide()}};var target;if(config.showOnHover){elm.hide();target=searchElementsForSmartBinding(config.showOnHover,elm);if(target){target.mouseenter(function(){if(uo(config.enableHover)){showExec()}}).mouseleave(hideExec)}}else{if(config.hideOnHover){target=searchElementsForSmartBinding(config.hideOnHover,elm);if(target){target.mouseenter(function(){if(uo(config.enableHover)){hideExec()}}).mouseleave(showExec)}}}},update:function(element,valueAccessor){var value=uho(valueAccessor());var elm=$(element);var config=ko.utils.extend({visible:undefined,speed:"normal",complete:dummyCallback,showDelay:0,hideDelay:0},(typeof value=="boolean"?{visible:value}:value));if(config.visible===undefined){return}var func=config.visible?function(){elm.slideDown(config.speed,config.complete)}:function(){elm.slideUp(config.speed,config.complete)};var delay=value.visible?config.showDelay:config.hideDelay;var timer=$.data(element,"ko.slideVisible.update.timer");if(timer){clearTimeout(timer)}if(delay>0){$.data(element,"ko.slideVisible.update.timer",setTimeout(func,delay))}else{func()}}};ko.bindingHandlers.slideState={init:function(element,valueAccessor){var value=valueAccessor();if(!value.status||!value.statuses){return}var statuses={};for(var id in value.statuses){var st=value.statuses[id];statuses[id]={};statuses[id].params={};if(typeof st.left=="number"){statuses[id].params.left=st.left+"px";delete st.left}if(typeof st.top=="number"){statuses[id].params.top=st.top+"px";delete st.top}if(typeof st.right=="number"){statuses[id].params.right=st.right+"px";delete st.right}if(typeof st.bottom=="number"){statuses[id].params.bottom=st.bottom+"px";delete st.bottom}statuses[id].options=ko.utils.extend({visible:true,speed:"normal",delay:0,complete:dummyCallback},st);if(st.visible===false){statuses[id].options.complete=(function(){var complete=statuses[id].options.complete;var elm=$(element);return function(){elm.hide();complete()}})()}}$.data(element,"ko.slideState.statuses",statuses);var status=uo(valueAccessor().status);if(!status||!statuses[status]){return}var st=statuses[status];var elm=$(element);elm.css(st.params);st.options.visible?elm.show():elm.hide()},update:function(element,valueAccessor){var statuses=$.data(element,"ko.slideState.statuses");var status=uo(valueAccessor().status);if(!statuses||!status||!statuses[status]){return}var st=statuses[status];var elm=$(element);if(!st.options.visible&&elm.is(":hidden")){return}var options={duration:st.options.speed,complete:st.options.complete,queue:false};var doAnimate=function(){if(st.options.visible){elm.show()}elm.animate(st.params,options)};if(st.options.delay>0){setTimeout(doAnimate,st.options.delay)}else{doAnimate()}}};ko.bindingHandlers.hoverOpacity={init:function(element,valueAccessor){var value=valueAccessor();if(!value){return}var config=ko.utils.extend({over:0.7,out:1},typeof value=="object"?value:{});var elm=$(element);elm.mouseover(function(){elm.css("opacity",uo(config.over))}).mouseout(function(){elm.css("opacity",uo(config.out))})}};ko.bindingHandlers.outerClick={init:function(element,valueAccessor){var value=uo(valueAccessor());var elm=$(element);var config=ko.utils.extend({command:dummyCallback,enable:true,inners:false},(typeof value=="function"?{command:value}:value));var isInner=false;function onInnerClick(e){isInner=true}elm.click(onInnerClick);if(config.inners){var inners=searchElementsForSmartBinding(config.inners,elm);if(inners.length>0){inners.each(function(inner){$(inner).click(onInnerClick)})}}$(document).click(function(e){if(isInner){isInner=false;return}if(uo(config.enable)){config.command.call(element,ko.dataFor(element),e)}})}}})(jQuery);